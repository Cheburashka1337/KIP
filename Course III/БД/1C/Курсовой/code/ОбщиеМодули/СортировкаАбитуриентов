Процедура СортировкаАбитуриентовСправочник() Экспорт
	
	//Удаление
	Выборка = Справочники.СортировкаАбитуриентов.ВыбратьИерархически();
	Пока Выборка.Следующий() Цикл
	   ОбъектСправочника = Выборка.ПолучитьОбъект();
	   ОбъектСправочника.Удалить();
   КонецЦикла;
	КолвоЧеловекВГруппе = 1;
	ГлобальнаяНумирацияГрупп = 0;
	Для ИндексСчетчика = 0 по Перечисления.ПеречислениеСпециальностейАбитуринта.Количество()-1 Цикл
			
			ИмяГруппы = Перечисления.ПеречислениеСпециальностейАбитуринта.Получить(ИндексСчетчика);
			НоваяГруппа = Справочники.СортировкаАбитуриентов.СоздатьГруппу();
		    НоваяГруппа.Наименование = ИмяГруппы;
		    НоваяГруппа.Записать();
		
		Запрос = Новый Запрос;
	    Запрос.Текст = 
	        "ВЫБРАТЬ
	        |   Наименование, СпециальностьАбитурента, СреднийБаллАбитуриента, ТипАттестатаАбитуриента, ПриоритетЗачисленияАбитуриента,
			|   ФормаОплатыАбитуриента, ФотоАбитуриента, РодительАбитуриента, АдресАбитуриента, EmailАбитуриента, ТелефонАбитуриента, ДатаРожденияАбитуриента
	        |ИЗ
	        |   Справочник.Абитуриенты КАК Абитуриенты
	        |УПОРЯДОЧИТЬ ПО
	        |   СреднийБаллАбитуриента";
	 
	    РезультатЗапроса = Запрос.Выполнить();
	    ВыборкаАбитуриентов = РезультатЗапроса.Выбрать();
		
		ОбщийСчетчикАбитуриентовДляГрупп = 0;
		Пока ВыборкаАбитуриентов.Следующий() Цикл
			Если (ВыборкаАбитуриентов.СпециальностьАбитурента = ИмяГруппы) Тогда
				ОбщийСчетчикАбитуриентовДляГрупп = ОбщийСчетчикАбитуриентовДляГрупп + 1;
			КонецЕсли;
		КонецЦикла;
		ВыборкаАбитуриентов.Сбросить();
		Для СчетчикГрупп = 1 По (Окр(ОбщийСчетчикАбитуриентовДляГрупп/КолвоЧеловекВГруппе+0.5,0,0)) Цикл
		
				НоваяПодгруппа = Справочники.СортировкаАбитуриентов.СоздатьГруппу();
				ГлобальнаяНумирацияГрупп = ГлобальнаяНумирацияГрупп + 1; 
		    	НоваяПодгруппа.Наименование = "1"+ИмяГруппы+"-"+ГлобальнаяНумирацияГрупп+"17";
				НоваяПодгруппа.Родитель =  НоваяГруппа.Ссылка;
		    	НоваяПодгруппа.Записать();
				СчетчикЧеловекВГруппе = 0;
				Пока ВыборкаАбитуриентов.Следующий() Цикл		
					Если (ВыборкаАбитуриентов.СпециальностьАбитурента = ИмяГруппы) Тогда
						
						Абитуриент = Справочники.СортировкаАбитуриентов.СоздатьЭлемент();
						Абитуриент.Родитель = НоваяПодгруппа.Ссылка;
						Абитуриент.Наименование = ВыборкаАбитуриентов.Наименование;
						Абитуриент.СпециальностьАбитурента = ВыборкаАбитуриентов.СпециальностьАбитурента;
						Абитуриент.СреднийБаллАбитуриента = ВыборкаАбитуриентов.СреднийБаллАбитуриента;
						Абитуриент.ТипАттестатаАбитуриента = ВыборкаАбитуриентов.ТипАттестатаАбитуриента;
						Абитуриент.ПриоритетЗачисленияАбитуриента = ВыборкаАбитуриентов.ПриоритетЗачисленияАбитуриента;
						Абитуриент.ФормаОплатыАбитуриента = ВыборкаАбитуриентов.ФормаОплатыАбитуриента;
						Абитуриент.ФотоАбитуриента = ВыборкаАбитуриентов.ФотоАбитуриента;
						Абитуриент.РодительАбитуриента =  Справочники.РодителиАбитуриентов.НайтиПоНаименованию(ВыборкаАбитуриентов.РодительАбитуриента).Ссылка;
						Абитуриент.АдресАбитуриента = ВыборкаАбитуриентов.АдресАбитуриента;
						Абитуриент.EmailАбитуриента =  ВыборкаАбитуриентов.EmailАбитуриента;
						Абитуриент.ТелефонАбитуриента = ВыборкаАбитуриентов.ТелефонАбитуриента;
						Абитуриент.ДатаРожденияАбитуриента = ВыборкаАбитуриентов.ДатаРожденияАбитуриента; 
						Абитуриент.Записать();
						СчетчикЧеловекВГруппе = СчетчикЧеловекВГруппе + 1;
						
						Если (СчетчикЧеловекВГруппе = КолвоЧеловекВГруппе) Тогда
							Прервать;
						КонецЕсли;
					КонецЕсли;		
				КонецЦикла;
			КонецЦикла;				
	КонецЦикла; 	
КонецПроцедуры

